% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/dynamic_cee_mg.R
\name{dynamic_cce_mg}
\alias{dynamic_cce_mg}
\title{Dynamic Common Correlated Effects Mean Group (CCE-MG) Estimator}
\usage{
dynamic_cce_mg(
  formula,
  data,
  id = NULL,
  time = NULL,
  p = 3,
  na.action = na.omit,
  vcov_unit = c("OLS", "HC"),
  cd_method = c("CDstar", "CD", "none")
)
}
\arguments{
\item{formula}{y ~ x1 + x2 + ...}

\item{data}{data.frame, tibble, or `plm::pdata.frame`.}

\item{id, time}{Character names of unit and time identifiers (required if not a `pdata.frame`).}

\item{p}{Integer, number of CSA lags (default 3).}

\item{na.action}{NA handler (default `na.omit`).}

\item{vcov_unit}{One of c("OLS","HC"); per-unit covariance for reporting only.}

\item{cd_method}{One of c("CDstar","CD","none"); residual cross-section test to run in summary.}
}
\value{
An object of class 'dynamic_cce_mg' with:
  - coef: MG coefficients (named vector; intercept, lag_y, own regressors only)
  - se: MG standard errors from cross-section dispersion
  - vcov_mg: MG variance-covariance matrix
  - coef_i, vcov_i: per-unit estimates and vcov
  - residuals: pdata.frame(id,time,residual)
  - r.squared: per-unit R^2
  - meta: list with N,T,p, regressors, CSA spec
}
\description{
Levels ARDL(1) with Common Correlated Effects (CCE) augmentation and
Mean Group (MG) averaging. Includes p lags of cross-sectional averages (CSAs)
of y and regressors. Designed for heterogeneous panels with latent common factors
(Chudik & Pesaran; Pesaran & Smith).
}
\details{
\strong{Model and purpose.}
This function implements a heterogeneous dynamic panel regression with latent common factors
using the \emph{Common Correlated Effects} (CCE) approach and \emph{Mean Group} (MG) averaging.
For each cross-section \(i=1,\dots,N\) and time \(t=1,\dots,T\), we estimate an ARDL(1) in levels:
\deqn{ y_{it} = \alpha_i + \phi_i y_{i,t-1} + x_{it}'\beta_i \;+\; z_t'\gamma_i \;+\; u_{it}, }
where \(x_{it}\) are unit-specific regressors and \(z_t\) collects \emph{cross-sectional averages} (CSAs)
of \(y\) and \(x\) and their lags (lag-augmented CCE).
The CSAs proxy the unobserved common factors and their dynamics; coefficients \((\phi_i,\beta_i,\gamma_i)\)
are allowed to be heterogeneous across units. The reported MG coefficients are averages of the
unit-level estimates for the subset of “economic” parameters (intercept, \(\phi_i\), and the
\(\beta_i\) on user-supplied regressors), excluding the CSA controls.

\strong{CCE augmentation and lagging.}
The CCE idea is to include at each \(t\) the contemporaneous CSAs \( \bar y_t, \bar x_t \) to span the
factor space induced by pervasive shocks. With weakly exogenous regressors and dynamic factors, it is
recommended to \emph{augment} the controls with \(p \ge 1\) lags of those CSAs to better track factor
persistence. Practically, the function:
\enumerate{
  \item Computes time-wise means \( \bar y_t = N_t^{-1}\sum_{i\in \mathcal{I}_t} y_{it}\) and
        \( \bar x_t = N_t^{-1}\sum_{i\in \mathcal{I}_t} x_{it}\), where \( \mathcal{I}_t\) is the set of
        units observed at \(t\) (works with unbalanced panels).
  \item Forms \( \{\bar y_t, \bar x_t\}\) on a \emph{time-level} table, then adds lags
        \( \{\bar y_{t-\ell}, \bar x_{t-\ell}\}_{\ell=1}^p \) by time only.
  \item Merges those CSA controls back to the panel and estimates each unit equation by OLS.
}
This ordering is essential: lagging must be done \emph{by time}, not within the id–time rows, to avoid
mixing information across units.

\strong{Dynamic specification (ARDL(1)).}
The default specification includes one lag of \(y_{it}\) per unit (an ARDL(1) in levels). Higher-order
own lags could be added in extensions, but ARDL(1) is a common baseline in DC-CCE applications. Deterministic
components (unit intercepts) are included by default; unit-specific trends can be added in future versions.

\strong{Mean Group (MG) estimation and inference.}
Let \(\hat\theta_i\) be the vector of unit-level coefficients of interest (intercept, lag of \(y\), and
user regressors; CSA controls are \emph{nuisance} and are not averaged). The MG estimator is
\(\bar\theta = N^{-1}\sum_{i=1}^N \hat\theta_i\). Its variance is computed from the cross-sectional dispersion:
\deqn{ \widehat{\mathrm{Var}}(\bar\theta) = \frac{1}{N(N-1)} \sum_{i=1}^N
       \left(\hat\theta_i - \bar\theta\right)\left(\hat\theta_i - \bar\theta\right)'. }
Reported standard errors are the square-roots of the diagonal entries of this matrix. This is the usual MG
large-\(N\) inference, robust to slope heterogeneity across units. Per-unit OLS (or HC) SEs can be provided
for diagnostics, but MG uncertainty is driven by cross-section dispersion of the unit estimates.

\strong{Residual cross-sectional dependence.}
Even after CCE filtering, residuals may exhibit \emph{weak} cross-sectional dependence.
The summary method can run a dependence test; for best small-sample behavior, a bias-corrected CD test
(often called CD\*) is recommended. If only the classic CD test is available, interpret results cautiously
in factor-driven panels.

\strong{Unbalanced panels and missing data.}
CSAs at time \(t\) are computed using only units observed at \(t\); lags of CSAs are constructed on the
time index and then merged. Per-unit regressions are estimated on the rows that are complete for that unit
(with respect to \(y\), regressors, and all selected CSA controls), so some units may be dropped if
\(T_i\) becomes too small after lagging. MG averaging automatically adapts to the set of units actually
estimated (effective \(N\)).

\strong{Choosing the number of CSA lags \code{p}.}
The parameter \code{p} controls how aggressively we capture factor dynamics. Rules of thumb include small
fixed values (e.g., 1–3) for moderate \(T\), or data-driven selection via information criteria in larger samples.
Excessively large \code{p} with small \(T\) can over-fit and reduce usable observations.

\strong{What is averaged (and what is not).}
The \code{coef} and \code{se} returned by the function pertain to the intercept, the lag of \(y\), and the
user-specified regressors. The CSA controls (contemporaneous and lagged averages) are treated as high-dimensional
nuisance covariates used to span the factor space; their coefficients are \emph{not} summarized in the MG output.

\strong{Relation to alternative estimators.}
\itemize{
  \item \emph{MG vs PMG/DFE:} MG allows full slope heterogeneity and averages post-estimation.
        Pooled Mean Group (PMG) imposes long-run parameter homogeneity but allows heterogeneous adjustment
        dynamics; Dynamic Fixed Effects (DFE) imposes common slopes. MG is the least restrictive but can be less
        efficient if homogeneity holds.
  \item \emph{CCE vs standard FE:} Without CSA controls, correlated latent factors bias FE/OLS estimates when
        regressors load on the factors. CCE is designed to mitigate this by projecting on the space spanned by CSAs.
}

\strong{Numerical notes and diagnostics.}
Collinearity can arise when \code{p} is large relative to \(T\) or when regressors are highly persistent and
strongly correlated with CSAs. Inspect per-unit condition numbers, and consider reducing \code{p} or the set
of regressors. After estimation, inspect: (i) dispersion of unit-level coefficients, (ii) residual cross-section
tests (CD/CD\*), and (iii) sensitivity of MG estimates to \code{p}.

\strong{Limitations.}
The current version uses ARDL(1) and time-invariant \code{p} for all units. It does not (yet) include unit-specific
trends, higher-order dynamics, endogenous regressors with external instruments, or small-\(T\) finite-sample
corrections. These can be added in future releases.
}
\references{
\itemize{
  \item Chudik, A. and M. H. Pesaran (2015). \emph{Common correlated effects estimation with weakly exogenous regressors}.
  \item Pesaran, M. H. and R. Smith (1995). \emph{Estimating long-run relationships from dynamic heterogeneous panels}.
  \item Pesaran, M. H., Y. Shin, and R. P. Smith (1999). \emph{Pooled mean group estimation of dynamic heterogeneous panels}.
  \item Ditzen, J. (2021). \emph{Cross-sectional dependence in panel data models: concepts and estimation} (overview).}
(For residual dependence testing, see bias-corrected CD tests.)
}
