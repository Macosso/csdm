% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/csdm_internal_helpers.R
\name{.csdm_residual_matrix_r2}
\alias{.csdm_residual_matrix_r2}
\title{Compute R-squared (mg) from the final wide residual matrix and strictly aligned Y}
\usage{
.csdm_residual_matrix_r2(residuals_e, panel_df, id, time, yname, df_e = NULL)
}
\arguments{
\item{residuals_e}{Wide matrix of residuals (units x time), as from .csdm_residual_matrix().}

\item{panel_df}{Original panel data.frame.}

\item{id}{Name of id column.}

\item{time}{Name of time column.}

\item{yname}{Name of outcome variable.}
}
\value{
List with R2_i (by unit), R2_mg (mean), Y (aligned), and optionally R2_ols_i, R2_ols_mg.
}
\description{
This function computes R² (mg) for mean-group models using only the cells present in the final
wide residual matrix (residuals_e), with Y strictly aligned by id/time. This ensures R² reflects
the model's actual predictions and is robust to data alignment and NA-handling issues. Optionally
also returns the per-unit OLS R² for debugging.
}
